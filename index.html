
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>yarnspawner &#8212; yarnspawner 0.3.0+2.g4996476 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration Options" href="options.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="yarnspawner">
<h1>yarnspawner<a class="headerlink" href="#yarnspawner" title="Permalink to this headline">¶</a></h1>
<p>A custom <a class="reference external" href="https://github.com/jupyterhub/jupyterhub/wiki/Spawners">Spawner</a> for <a class="reference external" href="https://jupyterhub.readthedocs.io/">JupyterHub</a> that launches notebook servers on Apache
Hadoop/YARN clusters.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation" id="id1">Installation</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id2">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#set-the-jupyterhub-spawner-class" id="id3">Set the JupyterHub Spawner Class</a></p></li>
<li><p><a class="reference internal" href="#enable-proxy-user-permissions" id="id4">Enable Proxy User Permissions</a></p></li>
<li><p><a class="reference internal" href="#enable-kerberos-security-optional" id="id5">Enable Kerberos Security (Optional)</a></p></li>
<li><p><a class="reference internal" href="#specifying-python-environments" id="id6">Specifying Python Environments</a></p>
<ul>
<li><p><a class="reference internal" href="#using-a-local-environment" id="id7">Using a Local Environment</a></p></li>
<li><p><a class="reference internal" href="#using-an-archived-environment" id="id8">Using an Archived Environment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage-with-jupyterlab" id="id9">Usage with JupyterLab</a></p></li>
<li><p><a class="reference internal" href="#additional-configuration-options" id="id10">Additional Configuration Options</a></p></li>
<li><p><a class="reference internal" href="#example" id="id11">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-resources" id="id12">Additional Resources</a></p></li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id1">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>YarnSpawner should be installed in the same environment and node as JupyterHub
(usually an edge node). It can be installed using <a class="reference external" href="http://conda.io/">Conda</a>, Pip, or from source.</p>
<p><strong>Install with Conda:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">jupyterhub</span><span class="o">-</span><span class="n">yarnspawner</span>
</pre></div>
</div>
<p><strong>Install with Pip:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">jupyterhub</span><span class="o">-</span><span class="n">yarnspawner</span>
</pre></div>
</div>
<p><strong>Install from source:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jcrist</span><span class="o">/</span><span class="n">yarnspawner</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">yarnspawner</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h2><a class="toc-backref" href="#id2">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">YarnSpawner</span></code> requires some configuration and setup to use. This will vary
depending on your cluster, but will follow the same general procedure.</p>
<p>This assumes that you’ve already generated a <code class="docutils literal notranslate"><span class="pre">jupyterhub_config.py</span></code> file, as
described in the <a class="reference external" href="https://jupyterhub.readthedocs.io/en/stable/getting-started/config-basics.html">JupyterHub configuration documentation</a>.</p>
<p>For documentation on all available options see <a class="reference internal" href="options.html"><span class="doc">Configuration Options</span></a>.</p>
<div class="section" id="set-the-jupyterhub-spawner-class">
<h3><a class="toc-backref" href="#id3">Set the JupyterHub Spawner Class</a><a class="headerlink" href="#set-the-jupyterhub-spawner-class" title="Permalink to this headline">¶</a></h3>
<p>Tell JupyterHub to use <code class="docutils literal notranslate"><span class="pre">YarnSpawner</span></code> by adding the following line to your
<code class="docutils literal notranslate"><span class="pre">jupyterhub_config.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">spawner_class</span> <span class="o">=</span> <span class="s1">&#39;yarnspawner.YarnSpawner&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="enable-proxy-user-permissions">
<h3><a class="toc-backref" href="#id4">Enable Proxy User Permissions</a><a class="headerlink" href="#enable-proxy-user-permissions" title="Permalink to this headline">¶</a></h3>
<p>YarnSpawner makes full use of Hadoop’s security model, and will start Jupyter
notebook server’s in containers with the requesting user’s permissions (e.g. if
<code class="docutils literal notranslate"><span class="pre">alice</span></code> logs in to JupyterHub, their notebook server will be running as user
<code class="docutils literal notranslate"><span class="pre">alice</span></code>). To accomplish this, JupyterHub needs <a class="reference external" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html">proxy user</a> permissions.
This allows the JupyterHub server to perform actions impersonating another user.</p>
<p>To enable this you’ll need to do the following:</p>
<ol class="arabic">
<li><p>Create a user for JupyterHub to run under. Here we’ll use <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code>.</p></li>
<li><p>Enable <a class="reference external" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html">proxy user</a> permissions for this user. The users <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> has
permission to impersonate can be restricted to certain groups, and requests
to impersonate may be restricted to certain hosts. At a minimum,
<code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> will require permission to impersonate any JupyterHub user,
with requests allowed from at least the host running JupyterHub.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>hadoop.proxyuser.jupyterhub.hosts<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>host-where-jupyterhub-is-running<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>hadoop.proxyuser.jupyterhub.groups<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>group1,group2<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
<p>If looser restrictions are acceptable, you may also use the wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code>
to allow impersonation of any user or from any host.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>hadoop.proxyuser.jupyterhub.hosts<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>*<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>hadoop.proxyuser.jupyterhub.groups<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>*<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html">proxy user</a> documentation for more information.</p>
</li>
</ol>
</div>
<div class="section" id="enable-kerberos-security-optional">
<h3><a class="toc-backref" href="#id5">Enable Kerberos Security (Optional)</a><a class="headerlink" href="#enable-kerberos-security-optional" title="Permalink to this headline">¶</a></h3>
<p>If your cluster has Kerberos enabled, you’ll also need to create a principal
and keytab for the JupyterHub user (we’ll continue using <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> for
this, as above).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the jupyterhub principal</span>
$ kadmin -q <span class="s2">&quot;addprinc -randkey jupyterhub@YOUR_REALM.COM&quot;</span>

<span class="c1"># Create a keytab</span>
$ kadmin -q <span class="s2">&quot;xst -norandkey -k /path/to/jupyterhub.keytab</span>
</pre></div>
</div>
<p>Store the keytab file wherever you see fit (we recommend storing it along with
the jupyterhub configuration). You’ll also want to make sure that
<code class="docutils literal notranslate"><span class="pre">jupyterhub.keytab</span></code> is only readable by the <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> user.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ sudo chown jupyterhub /path/to/jupyterhub.keytab
$ sudo chmod <span class="m">400</span> /path/to/jupyterhub.keytab
</pre></div>
</div>
<p>To configure JupyterHub to use this keytab file, you’ll need to add the
following line to your <code class="docutils literal notranslate"><span class="pre">jupyterhub_config.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The principal JupyterHub is running as</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">principal</span> <span class="o">=</span> <span class="s1">&#39;jupyterhub&#39;</span>

<span class="c1"># Path to the keytab you created</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">keytab</span> <span class="o">=</span> <span class="s1">&#39;/path/to/jupyterhub.keytab&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-python-environments">
<h3><a class="toc-backref" href="#id6">Specifying Python Environments</a><a class="headerlink" href="#specifying-python-environments" title="Permalink to this headline">¶</a></h3>
<p>Since the user’s notebook servers will be each running in their own YARN
container, you’ll need to provide a way for Python environments to be available
to these containers. You have a few options here:</p>
<ul class="simple">
<li><p>Install identical Python environments on every node</p></li>
<li><p>Archive environments to be distributed to the container at runtime (recommended)</p></li>
</ul>
<p>In either case, the Python environment requires at minimum:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">notebook</span></code></p></li>
</ul>
<div class="section" id="using-a-local-environment">
<h4><a class="toc-backref" href="#id7">Using a Local Environment</a><a class="headerlink" href="#using-a-local-environment" title="Permalink to this headline">¶</a></h4>
<p>If you’ve installed identical Python environments on every node, you only need
to configure <code class="docutils literal notranslate"><span class="pre">YarnSpawner</span></code> to use the provided Python. This could be done a
few different ways:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the path to python in the startup command</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;/path/to/python -m yarnspawner.singleuser&#39;</span>

<span class="c1"># OR</span>
<span class="c1"># Activate a local conda environment before startup</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">prologue</span> <span class="o">=</span> <span class="s1">&#39;conda activate /path/to/your/environment&#39;</span>

<span class="c1"># OR</span>
<span class="c1"># Activate a virtual environment before startup</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">prologue</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/your/environment/bin/activate&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-an-archived-environment">
<h4><a class="toc-backref" href="#id8">Using an Archived Environment</a><a class="headerlink" href="#using-an-archived-environment" title="Permalink to this headline">¶</a></h4>
<p>YARN also provides mechanisms to “localize” files/archives to a container
before starting the application. This can be used to distribute Python
environments at runtime. This approach is appealing in that it doesn’t require
installing anything throughout the cluster, and allows for centrally managing
your user’s Python environments.</p>
<p>Packaging environments for distribution is usually accomplished using</p>
<ul class="simple">
<li><p><a class="reference external" href="https://conda.github.io/conda-pack/">conda-pack</a> for <a class="reference external" href="http://conda.io/">conda</a> environments</p></li>
<li><p><a class="reference external" href="https://jcrist.github.io/venv-pack/">venv-pack</a>  for virtual environments (both <a class="reference external" href="https://virtualenv.pypa.io/en/stable/">venv</a> and <a class="reference external" href="https://virtualenv.pypa.io/en/stable/">virtualenv</a> supported)</p></li>
</ul>
<p>Both are tools for taking an environment and creating an archive of it in a way
that (most) absolute paths in any libraries or scripts are altered to be
relocatable. This archive then can be distributed with your application, and
will be automatically extracted during <a class="reference external" href="https://hortonworks.com/blog/resource-localization-in-yarn-deep-dive/">YARN resource localization</a></p>
<p>Below we demonstrate creating and Packaging a python environment containing all
the required jupyter packages, as well as <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>.
Additional packages could be added as needed.</p>
<p><strong>Packaging a Conda Environment with Conda-Pack</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new conda environment</span>
$ conda create -c conda-forge -y -n example
...

<span class="c1"># Activate the environment</span>
$ conda activate example

<span class="c1"># Install the needed packages</span>
$ conda install -c conda-forge -y <span class="se">\</span>
conda-pack <span class="se">\</span>
jupyterhub-yarnspawner <span class="se">\</span>
pandas <span class="se">\</span>
scikit-learn
...

<span class="c1"># Pip required to avoid hardcoded path in kernelspec (for now)</span>
$ pip install notebook

<span class="c1"># Package the environment into environment.tar.gz</span>
$ conda pack -o environment.tar.gz
Collecting packages...
Packing environment at <span class="s1">&#39;/home/jcrist/miniconda/envs/example&#39;</span> to <span class="s1">&#39;environment.tar.gz&#39;</span>
<span class="o">[</span><span class="c1">########################################] | 100% Completed | 24.2s</span>
</pre></div>
</div>
<p><strong>Packaging a Virtual Environment with Venv-Pack</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a virtual environment</span>
$ python -m venv example            <span class="c1"># Using venv</span>
$ python -m virtualenv example      <span class="c1"># Or using virtualenv</span>
...

<span class="c1"># Activate the environment</span>
$ <span class="nb">source</span> example/bin/activate

<span class="c1"># Install the needed packages</span>
$ pip install <span class="se">\</span>
venv-pack <span class="se">\</span>
jupyterhub-yarnspawner <span class="se">\</span>
notebook <span class="se">\</span>
pandas <span class="se">\</span>
scikit-learn
...

<span class="c1"># Package the environment into environment.tar.gz</span>
$ venv-pack -o environment.tar.gz
Collecting packages...
Packing environment at <span class="s1">&#39;/home/jcrist/environments/example&#39;</span> to <span class="s1">&#39;environment.tar.gz&#39;</span>
<span class="o">[</span><span class="c1">########################################] | 100% Completed |  12.4s</span>
</pre></div>
</div>
<p>Note that the python linked to in the virtual environment must exist and be
accessible on every node in the YARN cluster. If the environment was created
with a different Python, you can change the link path using the
<code class="docutils literal notranslate"><span class="pre">--python-prefix</span></code> flag. For more information see the <a class="reference external" href="https://jcrist.github.io/venv-pack/">venv-pack
documentation</a>.</p>
<p><strong>Using the Packaged Environment</strong></p>
<p>It is recommended to upload the environments to some directory on HDFS
beforehand, to avoid repeating the upload cost for every user. This directory
should be readable by all users, but writable only by the admin user managing
Python environments (here we’ll use the <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> user).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ hdfs dfs -mkdir /path/to/environments
$ hdfs dfs -chown jupyterhub /path/to/environments
$ hdfs dfs -chmod <span class="m">744</span> /path/to/environments
</pre></div>
</div>
<p>To use the packaged environment with <code class="docutils literal notranslate"><span class="pre">YarnSpawner</span></code>, you need to include
the archive in <code class="docutils literal notranslate"><span class="pre">YarnSpawner.localize_files</span></code>, and activate the environment in
<code class="docutils literal notranslate"><span class="pre">YarnSpawner.prologue</span></code>. This looks the same for environments packaged using
either tool.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">localize_files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;environment&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;hdfs:///path/to/environments/environment.tar.gz&#39;</span><span class="p">,</span>
        <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">prologue</span> <span class="o">=</span> <span class="s1">&#39;source environment/bin/activate&#39;</span>
</pre></div>
</div>
<p>Note that we set <code class="docutils literal notranslate"><span class="pre">visibility</span></code> to <code class="docutils literal notranslate"><span class="pre">public</span></code> for the environment, so that
multiple users can all share the same localized environment (reducing the cost
of moving the environments around).</p>
<p>For more information, see the <a class="reference external" href="https://jcrist.github.io/skein/distributing-files.html">Skein documentation on distributing files</a>.</p>
</div>
</div>
<div class="section" id="usage-with-jupyterlab">
<h3><a class="toc-backref" href="#id9">Usage with JupyterLab</a><a class="headerlink" href="#usage-with-jupyterlab" title="Permalink to this headline">¶</a></h3>
<p>JupyterHub can use <a class="reference external" href="https://jupyterlab.readthedocs.io/">JupyterLab</a> as the frontend instead of the classic notebook
interface. To do this, take the following steps:</p>
<ol class="arabic">
<li><p>Install JupyterLab into the notebook (not the JupyterHub) environment.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install using conda</span>
conda install -c conda-forge jupyterlab

<span class="c1"># Or install with pip</span>
pip install jupyterlab
</pre></div>
</div>
</li>
<li><p>Install the JupyterLab Hub extension into the notebook (not the JupyterHub)
environment. This isn’t strictly necessary, but adds a JupyterHub control
panel to the JupyterLab UI allowing easier login/logout.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jupyter labextension install @jupyterlab/hub-extension
</pre></div>
</div>
</li>
<li><p>Configure JupyterHub to use JupyterLab instead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start users in JupyterLab by default</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">default_url</span> <span class="o">=</span> <span class="s1">&#39;/lab&#39;</span>

<span class="c1"># Start JupyterLab with the hub extension (only required if you</span>
<span class="c1"># installed the JupyterLab Hub extension above)</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;python -m yarnspawner.jupyter_labhub&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ol>
<p>For more information see <a class="reference external" href="https://jupyterlab.readthedocs.io/en/stable/user/jupyterhub.html">JupyterLab on JupyterHub</a> and <a class="reference external" href="https://jupyterlab.readthedocs.io/en/stable/user/jupyterhub.html">JupyterLab Hub
Extension</a> documentation.</p>
</div>
<div class="section" id="additional-configuration-options">
<h3><a class="toc-backref" href="#id10">Additional Configuration Options</a><a class="headerlink" href="#additional-configuration-options" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">YarnSpawner</span></code> has several additional configuration fields. See <a class="reference internal" href="options.html"><span class="doc">Configuration Options</span></a>
for documentation on all available options. At a minimum you’ll probably want
to configure the memory and cpu limits, as well as which YARN queue to use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The memory limit for a notebook instance.</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">mem_limit</span> <span class="o">=</span> <span class="s1">&#39;2 G&#39;</span>

<span class="c1"># The cpu limit for a notebook instance</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">cpu_limit</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># The YARN queue to use</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h3><a class="toc-backref" href="#id11">Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>In summary, an example <code class="docutils literal notranslate"><span class="pre">jupyterhub_config.py</span></code> configuration enabling
<code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code> might look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable yarnspawner</span>
<span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">spawner_class</span> <span class="o">=</span> <span class="s1">&#39;yarnspawner.YarnSpawner&#39;</span>

<span class="c1"># Configuration for kerberos security</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">principal</span> <span class="o">=</span> <span class="s1">&#39;jupyterhub&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">keytab</span> <span class="o">=</span> <span class="s1">&#39;/etc/jupyer/jupyter.keytab&#39;</span>

<span class="c1"># Resource limits per-user</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">mem_limit</span> <span class="o">=</span> <span class="s1">&#39;2 G&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">cpu_limit</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># The YARN queue to use</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;jupyterhub&#39;</span>

<span class="c1"># Specify location of the archived Python environment</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">localize_files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;environment&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;hdfs:///path/to/environments/environment.tar.gz&#39;</span><span class="p">,</span>
        <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnSpawner</span><span class="o">.</span><span class="n">prologue</span> <span class="o">=</span> <span class="s1">&#39;source environment/bin/activate&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="additional-resources">
<h2><a class="toc-backref" href="#id12">Additional Resources</a><a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<p>If you’re interested in <code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code>, you may also be interested in a few
other libraries:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jcrist.github.io/hdfscm/">jupyter-hdfscm</a>: A Jupyter <a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/extending/contents.html">ContentsManager</a> for storing notebooks on HDFS.
This can be used with <code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code> to provide a way to persist notebooks
between sessions.</p></li>
<li><p><a class="reference external" href="https://arrow.apache.org/docs/python/">pyarrow</a>: Among other things, this Python library provides efficient access
to HDFS, as well as the Parquet, and ORC file formats.</p></li>
<li><p><a class="reference external" href="https://yarn.dask.org/">dask-yarn</a>: A library for deploying <a class="reference external" href="https://dask.org/">Dask</a> on YARN. This
library works fine with <code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code>, allowing users to launch Dask
clusters from inside notebooks started by <code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code>.</p></li>
<li><p><a class="reference external" href="https://github.com/minrk/findspark">findspark</a>: A library enabling using <a class="reference external" href="https://spark.apache.org/docs/0.9.0/python-programming-guide.html">PySpark</a> as a normal Python library.
This can be used to enable users to launch Spark clusters from inside
notebooks started by <code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code>.</p></li>
<li><p><a class="reference external" href="https://jcrist.github.io/skein/">skein</a>: Both <code class="docutils literal notranslate"><span class="pre">yarnspawner</span></code> and <code class="docutils literal notranslate"><span class="pre">dask-yarn</span></code> are built on <code class="docutils literal notranslate"><span class="pre">skein</span></code>, a
library for writing and deploying generic applications on YARN.</p></li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">yarnspawner</a></h1>



<p class="blurb">A JupyterHub Spawner for deploying on Apache Hadoop/YARN</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jcrist&repo=yarnspawner&type=watch&count=False&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/jcrist/yarnspawner">
    <img
        alt="https://secure.travis-ci.org/jcrist/yarnspawner.svg?branch=master"
        src="https://secure.travis-ci.org/jcrist/yarnspawner.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="options.html">Configuration Options</a></li>
</ul>

<h3>Need help?</h3>

<p>
  Open an issue in the <a href="https://github.com/jcrist/yarnspawner/issues">issue tracker</a>.
</p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Jim Crist.
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>